<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Admin Panel - Knowledge Development Stationery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .riyal-symbol {
            font-family: 'Arial', sans-serif;
            font-weight: bold;
        }
        .btn-primary {
            @apply bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors;
        }
        .btn-secondary {
            @apply bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors;
        }
        .btn-danger {
            @apply bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors;
        }
        .btn-success {
            @apply bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <h1 class="text-lg sm:text-2xl font-bold text-gray-900">Admin Panel</h1>
                    <span class="ml-2 sm:ml-4 text-xs sm:text-sm text-gray-500 hidden sm:inline">Knowledge Development Stationery</span>
                </div>
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <a href="stationery-website.html" class="text-blue-600 hover:text-blue-800 text-sm sm:text-base">
                        <i class="fas fa-arrow-left mr-1 sm:mr-2"></i><span class="hidden sm:inline">Back to Store</span><span class="sm:hidden">Back</span>
                    </a>
                    <button onclick="logout()" class="btn-secondary text-sm sm:text-base">
                        <i class="fas fa-sign-out-alt mr-1 sm:mr-2"></i><span class="hidden sm:inline">Logout</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Stats Cards -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-8">
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex items-center">
                    <div class="p-2 bg-blue-100 rounded-lg">
                        <i class="fas fa-shopping-cart text-blue-600"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">Total Orders</p>
                        <p class="text-2xl font-bold text-gray-900">24</p>
                    </div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex items-center">
                    <div class="p-2 bg-green-100 rounded-lg">
                        <i class="fas fa-dollar-sign text-green-600"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">Revenue</p>
                        <p class="text-2xl font-bold text-gray-900">2,450 <span class="riyal-symbol">﷼</span></p>
                    </div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex items-center">
                    <div class="p-2 bg-yellow-100 rounded-lg">
                        <i class="fas fa-box text-yellow-600"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">Products</p>
                        <p class="text-2xl font-bold text-gray-900">36</p>
                    </div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex items-center">
                    <div class="p-2 bg-purple-100 rounded-lg">
                        <i class="fas fa-users text-purple-600"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">Customers</p>
                        <p class="text-2xl font-bold text-gray-900">18</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="bg-white rounded-lg shadow">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8 px-6">
                    <button onclick="showTab('orders')" class="tab-button py-4 px-1 border-b-2 border-blue-500 text-blue-600 font-medium text-sm">
                        <i class="fas fa-list mr-2"></i>Orders
                    </button>
                    <button onclick="showTab('products')" class="tab-button py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm">
                        <i class="fas fa-box mr-2"></i>Products
                    </button>
                    <button onclick="showTab('inventory')" class="tab-button py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm">
                        <i class="fas fa-warehouse mr-2"></i>Inventory
                    </button>
                    <button onclick="showTab('reports')" class="tab-button py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm">
                        <i class="fas fa-chart-bar mr-2"></i>Reports
                    </button>
                </nav>
            </div>

            <!-- Orders Tab -->
            <div id="orders-tab" class="tab-content p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-semibold text-gray-900">Recent Orders</h2>
                    <button class="btn-primary">
                        <i class="fas fa-plus mr-2"></i>New Order
                    </button>
                </div>
                <div class="overflow-x-auto -mx-4 sm:mx-0">
                    <table class="min-w-full divide-y divide-gray-200 text-sm">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Items</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">ORD-1759096838877</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">customer@gmail.com</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Printer Paper A4 (1000 sheets) x 1</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">85.00 <span class="riyal-symbol">﷼</span></td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Paid</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button class="text-blue-600 hover:text-blue-900 mr-3">View</button>
                                    <button class="text-green-600 hover:text-green-900">Print</button>
                                </td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">ORD-1759096838876</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">john@example.com</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Gel Pen Set (12 colors) x 2</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">50.00 <span class="riyal-symbol">﷼</span></td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Pending</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button class="text-blue-600 hover:text-blue-900 mr-3">View</button>
                                    <button class="text-green-600 hover:text-green-900">Print</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Products Tab -->
            <div id="products-tab" class="tab-content p-6 hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-semibold text-gray-900">Product Management</h2>
                    <button onclick="addNewProduct()" class="btn-primary">
                        <i class="fas fa-plus mr-2"></i>Add Product
                    </button>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
                    <div class="border rounded-lg p-4">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-medium">Premium Ballpoint Pen</h3>
                            <span class="text-sm text-gray-500">15.50 <span class="riyal-symbol">﷼</span></span>
                        </div>
                        <p class="text-sm text-gray-600 mb-3">Stock: 50</p>
                        <div class="flex space-x-2">
                            <button class="btn-secondary text-xs">Edit</button>
                            <button class="btn-danger text-xs">Delete</button>
                        </div>
                    </div>
                    <div class="border rounded-lg p-4">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-medium">Gel Pen Set (12 colors)</h3>
                            <span class="text-sm text-gray-500">25.00 <span class="riyal-symbol">﷼</span></span>
                        </div>
                        <p class="text-sm text-gray-600 mb-3">Stock: 30</p>
                        <div class="flex space-x-2">
                            <button class="btn-secondary text-xs">Edit</button>
                            <button class="btn-danger text-xs">Delete</button>
                        </div>
                    </div>
                    <div class="border rounded-lg p-4">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-medium">Fountain Pen</h3>
                            <span class="text-sm text-gray-500">45.00 <span class="riyal-symbol">﷼</span></span>
                        </div>
                        <p class="text-sm text-gray-600 mb-3">Stock: 15</p>
                        <div class="flex space-x-2">
                            <button class="btn-secondary text-xs">Edit</button>
                            <button class="btn-danger text-xs">Delete</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventory Tab -->
            <div id="inventory-tab" class="tab-content p-6 hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-semibold text-gray-900">Inventory Management</h2>
                    <button onclick="showAddStockModal()" class="btn-primary">
                        <i class="fas fa-plus mr-2"></i>Add Stock
                    </button>
                </div>
                <div class="overflow-x-auto -mx-4 sm:mx-0">
                    <table class="min-w-full divide-y divide-gray-200 text-sm">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Current Stock</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sold Today</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="inventory-tbody">
                            <!-- Inventory items will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reports-tab" class="tab-content p-6 hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-semibold text-gray-900">Sales Reports</h2>
                    <button onclick="exportReport()" class="btn-primary">
                        <i class="fas fa-download mr-2"></i>Export Report
                    </button>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
                    <div class="bg-white p-6 rounded-lg border">
                        <h3 class="text-lg font-semibold mb-4">Daily Sales</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Today</span>
                                <span class="font-semibold">450.00 <span class="riyal-symbol">﷼</span></span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Yesterday</span>
                                <span class="font-semibold">320.00 <span class="riyal-symbol">﷼</span></span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">This Week</span>
                                <span class="font-semibold">2,150.00 <span class="riyal-symbol">﷼</span></span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg border">
                        <h3 class="text-lg font-semibold mb-4">Top Products</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Printer Paper A4</span>
                                <span class="font-semibold">15 sold</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Gel Pen Set</span>
                                <span class="font-semibold">12 sold</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Premium Ballpoint Pen</span>
                                <span class="font-semibold">8 sold</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Sample data
        let orders = [
            {
                id: 'ORD-1759096838877',
                customer: 'customer@gmail.com',
                items: [{ name: 'Printer Paper A4 (1000 sheets)', quantity: 1, price: 85.00 }],
                total: 85.00,
                status: 'paid',
                paymentMethod: 'MASTERCARD',
                date: '2025-01-28 18:00:38',
                notes: ''
            },
            {
                id: 'ORD-1759096838876',
                customer: 'john@example.com',
                items: [{ name: 'Gel Pen Set (12 colors)', quantity: 2, price: 25.00 }],
                total: 50.00,
                status: 'pending',
                paymentMethod: 'VISA',
                date: '2025-01-28 17:30:15',
                notes: ''
            }
        ];

        let products = [
            { id: 1, name: 'Premium Ballpoint Pen', nameAr: 'قلم حبر جاف متميز', price: 15.50, stock: 50, image: 'https://images.unsplash.com/photo-1583394838336-acd977736f90?w=300&h=300&fit=crop', category: 'pens' },
            { id: 2, name: 'Gel Pen Set (12 colors)', nameAr: 'مجموعة أقلام جيل (12 لون)', price: 25.00, stock: 30, image: 'https://images.unsplash.com/photo-1598300042247-d088f8ab3a91?w=300&h=300&fit=crop', category: 'pens' },
            { id: 3, name: 'Fountain Pen', nameAr: 'قلم حبر', price: 45.00, stock: 15, image: 'https://images.unsplash.com/photo-1561070791-2526d30994b5?w=300&h=300&fit=crop', category: 'pens' }
        ];

        function showTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.add('hidden'));
            
            // Remove active class from all buttons
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => {
                button.classList.remove('border-blue-500', 'text-blue-600');
                button.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            
            // Add active class to clicked button
            event.target.classList.remove('border-transparent', 'text-gray-500');
            event.target.classList.add('border-blue-500', 'text-blue-600');

            // Load data for specific tabs
            if (tabName === 'orders') {
                loadOrders();
            } else if (tabName === 'products') {
                loadProducts();
            } else if (tabName === 'inventory') {
                loadInventory();
            }
        }

        function loadOrders() {
            const tbody = document.querySelector('#orders-tab tbody');
            tbody.innerHTML = orders.map(order => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${order.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${order.customer}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${order.items.map(item => `${item.name} × ${item.quantity}`).join(', ')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${order.total.toFixed(2)} <span class="riyal-symbol">﷼</span></td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <select onchange="updateOrderStatus('${order.id}', this.value)" class="text-xs rounded border-gray-300">
                            <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="paid" ${order.status === 'paid' ? 'selected' : ''}>Paid</option>
                            <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
                            <option value="ready" ${order.status === 'ready' ? 'selected' : ''}>Ready for Pickup</option>
                            <option value="picked_up" ${order.status === 'picked_up' ? 'selected' : ''}>Picked Up</option>
                            <option value="returned" ${order.status === 'returned' ? 'selected' : ''}>Returned</option>
                            <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                        </select>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="editOrder('${order.id}')" class="text-blue-600 hover:text-blue-900 mr-3">Edit</button>
                        <button onclick="viewOrder('${order.id}')" class="text-green-600 hover:text-green-900 mr-3">View</button>
                        <button onclick="printOrder('${order.id}')" class="text-purple-600 hover:text-purple-900">Print</button>
                    </td>
                </tr>
            `).join('');
        }

        function loadProducts() {
            const container = document.querySelector('#products-tab .grid');
            container.innerHTML = products.map(product => `
                <div class="border rounded-lg p-4">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-medium">${product.name}</h3>
                        <span class="text-sm text-gray-500">${product.price.toFixed(2)} <span class="riyal-symbol">﷼</span></span>
                    </div>
                    <div class="mb-3">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-32 object-cover rounded mb-2">
                        <p class="text-sm text-gray-600">Stock: ${product.stock}</p>
                        <p class="text-xs text-gray-500">Category: ${product.category}</p>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="editProduct(${product.id})" class="btn-secondary text-xs">Edit</button>
                        <button onclick="deleteProduct(${product.id})" class="btn-danger text-xs">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function loadInventory() {
            const tbody = document.getElementById('inventory-tbody');
            if (!tbody) return;
            
            tbody.innerHTML = products.map(product => {
                const status = product.stock > 20 ? 'In Stock' : product.stock > 5 ? 'Low Stock' : 'Out of Stock';
                const statusColor = product.stock > 20 ? 'bg-green-100 text-green-800' : 
                                  product.stock > 5 ? 'bg-yellow-100 text-yellow-800' : 
                                  'bg-red-100 text-red-800';
                
                return `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${product.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${product.stock}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${Math.floor(Math.random() * 10)}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">${status}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="updateStock(${product.id}, prompt('Enter new stock quantity:', ${product.stock}))" class="text-blue-600 hover:text-blue-900">Update</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function updateOrderStatus(orderId, newStatus) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.status = newStatus;
                showNotification(`Order ${orderId} status updated to ${newStatus}`, 'success');
                loadOrders();
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                'bg-blue-500'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        function editOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center p-2 sm:p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-semibold">Edit Order ${orderId}</h2>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <form onsubmit="saveOrderChanges(event, '${orderId}')">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Customer Email</label>
                                    <input type="email" value="${order.customer}" name="customer" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                    <select name="status" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                                        <option value="paid" ${order.status === 'paid' ? 'selected' : ''}>Paid</option>
                                        <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
                                        <option value="ready" ${order.status === 'ready' ? 'selected' : ''}>Ready for Pickup</option>
                                        <option value="picked_up" ${order.status === 'picked_up' ? 'selected' : ''}>Picked Up</option>
                                        <option value="returned" ${order.status === 'returned' ? 'selected' : ''}>Returned</option>
                                        <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Order Items</label>
                                <div id="order-items">
                                    ${order.items.map((item, index) => `
                                        <div class="flex items-center space-x-2 mb-2">
                                            <input type="text" value="${item.name}" name="itemName_${index}" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <input type="number" value="${item.quantity}" name="itemQuantity_${index}" min="1" class="w-20 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <input type="number" value="${item.price}" name="itemPrice_${index}" step="0.01" min="0" class="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <button type="button" onclick="removeOrderItem(this)" class="text-red-600 hover:text-red-800">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    `).join('')}
                                </div>
                                <button type="button" onclick="addOrderItem()" class="text-blue-600 hover:text-blue-800 text-sm">
                                    <i class="fas fa-plus mr-1"></i>Add Item
                                </button>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                                <textarea name="notes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">${order.notes}</textarea>
                            </div>
                            
                            <div class="flex justify-end space-x-3">
                                <button type="button" onclick="this.closest('.fixed').remove()" class="btn-secondary">Cancel</button>
                                <button type="submit" class="btn-primary">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function saveOrderChanges(event, orderId) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const order = orders.find(o => o.id === orderId);
            
            if (order) {
                order.customer = formData.get('customer');
                order.status = formData.get('status');
                order.notes = formData.get('notes');
                
                // Update items
                const items = [];
                let index = 0;
                while (formData.get(`itemName_${index}`)) {
                    items.push({
                        name: formData.get(`itemName_${index}`),
                        quantity: parseInt(formData.get(`itemQuantity_${index}`)),
                        price: parseFloat(formData.get(`itemPrice_${index}`))
                    });
                    index++;
                }
                order.items = items;
                
                // Recalculate total
                order.total = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                
                showNotification(`Order ${orderId} updated successfully`, 'success');
                loadOrders();
                event.target.closest('.fixed').remove();
            }
        }

        function addOrderItem() {
            const container = document.getElementById('order-items');
            const index = container.children.length;
            const itemDiv = document.createElement('div');
            itemDiv.className = 'flex items-center space-x-2 mb-2';
            itemDiv.innerHTML = `
                <input type="text" name="itemName_${index}" placeholder="Item name" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <input type="number" name="itemQuantity_${index}" value="1" min="1" class="w-20 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <input type="number" name="itemPrice_${index}" value="0" step="0.01" min="0" class="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button type="button" onclick="removeOrderItem(this)" class="text-red-600 hover:text-red-800">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(itemDiv);
        }

        function removeOrderItem(button) {
            button.parentElement.remove();
        }

        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center p-2 sm:p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-semibold">Edit Product</h2>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <form onsubmit="saveProductChanges(event, ${productId})">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Product Name (English)</label>
                                    <input type="text" value="${product.name}" name="name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Product Name (Arabic)</label>
                                    <input type="text" value="${product.nameAr}" name="nameAr" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Price (SAR)</label>
                                    <input type="number" value="${product.price}" name="price" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Stock Quantity</label>
                                    <input type="number" value="${product.stock}" name="stock" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                <select name="category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="pens" ${product.category === 'pens' ? 'selected' : ''}>Pens & Writing</option>
                                    <option value="notebooks" ${product.category === 'notebooks' ? 'selected' : ''}>Notebooks & Paper</option>
                                    <option value="office" ${product.category === 'office' ? 'selected' : ''}>Office Supplies</option>
                                    <option value="art" ${product.category === 'art' ? 'selected' : ''}>Art Supplies</option>
                                    <option value="school" ${product.category === 'school' ? 'selected' : ''}>School Supplies</option>
                                    <option value="printing" ${product.category === 'printing' ? 'selected' : ''}>Printing & Technology</option>
                                </select>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Product Image</label>
                                <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg hover:border-gray-400 transition-colors">
                                    <div class="space-y-1 text-center">
                                        <i class="fas fa-camera text-gray-400 text-3xl mb-2"></i>
                                        <div class="flex text-sm text-gray-600">
                                            <label for="edit-image-upload" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500">
                                                <span>Upload new image</span>
                                                <input id="edit-image-upload" name="image" type="file" class="sr-only" accept="image/*" onchange="handleEditImageUpload(event)">
                                            </label>
                                            <p class="pl-1">or keep current</p>
                                        </div>
                                        <p class="text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p>
                                    </div>
                                </div>
                                <div class="mt-2 text-center">
                                    <img id="edit-image-preview" src="${product.image}" alt="Product preview" class="w-32 h-32 object-cover rounded border mx-auto">
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-3">
                                <button type="button" onclick="this.closest('.fixed').remove()" class="btn-secondary">Cancel</button>
                                <button type="submit" class="btn-primary">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function handleEditImageUpload(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('edit-image-preview');
            
            if (file) {
                // Check file size (10MB limit)
                if (file.size > 10 * 1024 * 1024) {
                    showNotification('File size must be less than 10MB', 'error');
                    return;
                }
                
                // Check file type
                if (!file.type.startsWith('image/')) {
                    showNotification('Please select an image file', 'error');
                    return;
                }
                
                // Create object URL for preview
                const imageUrl = URL.createObjectURL(file);
                preview.src = imageUrl;
                
                // Store the file for later use
                preview.dataset.file = file;
            }
        }

        function saveProductChanges(event, productId) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const product = products.find(p => p.id === productId);
            const preview = document.getElementById('edit-image-preview');
            
            if (product) {
                product.name = formData.get('name');
                product.nameAr = formData.get('nameAr');
                product.price = parseFloat(formData.get('price'));
                product.stock = parseInt(formData.get('stock'));
                product.category = formData.get('category');
                
                // Handle image update
                if (preview.dataset.file) {
                    // Convert file to base64 for storage
                    const file = preview.dataset.file;
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        product.image = e.target.result;
                        
                        // Save to localStorage for sync with main website
                        localStorage.setItem('stationeryProducts', JSON.stringify(products));
                        
                        showNotification(`Product "${product.name}" updated successfully`, 'success');
                        loadProducts();
                        loadInventory();
                        event.target.closest('.fixed').remove();
                    };
                    reader.readAsDataURL(file);
                } else {
                    // Keep current image
                    
                    // Save to localStorage for sync with main website
                    localStorage.setItem('stationeryProducts', JSON.stringify(products));
                    
                    showNotification(`Product "${product.name}" updated successfully`, 'success');
                    loadProducts();
                    loadInventory();
                    event.target.closest('.fixed').remove();
                }
            }
        }

        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                products = products.filter(p => p.id !== productId);
                
                // Save to localStorage for sync with main website
                localStorage.setItem('stationeryProducts', JSON.stringify(products));
                
                showNotification('Product deleted successfully', 'success');
                loadProducts();
                loadInventory();
            }
        }

        function updateStock(productId, newStock) {
            const product = products.find(p => p.id === productId);
            if (product) {
                product.stock = parseInt(newStock);
                showNotification(`Stock updated for ${product.name}`, 'success');
            }
        }

        function viewOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center p-2 sm:p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-semibold">Order Details - ${orderId}</h2>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm font-medium text-gray-700">Customer Email</label>
                                    <p class="text-gray-900">${order.customer}</p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-700">Status</label>
                                    <p class="text-gray-900 capitalize">${order.status.replace('_', ' ')}</p>
                                </div>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-700">Order Items</label>
                                <div class="mt-2 space-y-2">
                                    ${order.items.map(item => `
                                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                                            <span>${item.name} × ${item.quantity}</span>
                                            <span class="font-medium">${(item.price * item.quantity).toFixed(2)} <span class="riyal-symbol">﷼</span></span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="border-t pt-4">
                                <div class="flex justify-between text-lg font-semibold">
                                    <span>Total:</span>
                                    <span>${order.total.toFixed(2)} <span class="riyal-symbol">﷼</span></span>
                                </div>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-700">Payment Method</label>
                                <p class="text-gray-900">${order.paymentMethod}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-700">Order Date</label>
                                <p class="text-gray-900">${order.date}</p>
                            </div>
                            
                            ${order.notes ? `
                                <div>
                                    <label class="text-sm font-medium text-gray-700">Notes</label>
                                    <p class="text-gray-900">${order.notes}</p>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="this.closest('.fixed').remove()" class="btn-secondary">Close</button>
                            <button onclick="printOrder('${orderId}')" class="btn-primary">Print Receipt</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function addNewProduct() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center p-2 sm:p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-semibold">Add New Product</h2>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <form onsubmit="saveNewProduct(event)">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Product Name (English)</label>
                                    <input type="text" name="name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Product Name (Arabic)</label>
                                    <input type="text" name="nameAr" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Price (SAR)</label>
                                    <input type="number" name="price" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Stock Quantity</label>
                                    <input type="number" name="stock" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                <select name="category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="pens">Pens & Writing</option>
                                    <option value="notebooks">Notebooks & Paper</option>
                                    <option value="office">Office Supplies</option>
                                    <option value="art">Art Supplies</option>
                                    <option value="school">School Supplies</option>
                                    <option value="printing">Printing & Technology</option>
                                </select>
                            </div>
                            
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Product Image</label>
                            <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg hover:border-gray-400 transition-colors">
                                <div class="space-y-1 text-center">
                                    <i class="fas fa-camera text-gray-400 text-3xl mb-2"></i>
                                    <div class="flex text-sm text-gray-600">
                                        <label for="image-upload" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500">
                                            <span>Upload an image</span>
                                            <input id="image-upload" name="image" type="file" class="sr-only" accept="image/*" onchange="handleImageUpload(event)">
                                        </label>
                                        <p class="pl-1">or drag and drop</p>
                                    </div>
                                    <p class="text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p>
                                </div>
                            </div>
                            <div class="mt-2 text-center">
                                <img id="image-preview" src="" alt="Product preview" class="w-32 h-32 object-cover rounded border hidden mx-auto">
                            </div>
                        </div>
                            
                            <div class="flex justify-end space-x-3">
                                <button type="button" onclick="this.closest('.fixed').remove()" class="btn-secondary">Cancel</button>
                                <button type="submit" class="btn-primary">Add Product</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add image preview functionality
            const imageInput = modal.querySelector('input[name="image"]');
            const imagePreview = modal.querySelector('#image-preview');
            imageInput.addEventListener('input', function() {
                if (this.value) {
                    imagePreview.src = this.value;
                    imagePreview.classList.remove('hidden');
                } else {
                    imagePreview.classList.add('hidden');
                }
            });
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('image-preview');
            
            if (file) {
                // Check file size (10MB limit)
                if (file.size > 10 * 1024 * 1024) {
                    showNotification('File size must be less than 10MB', 'error');
                    return;
                }
                
                // Check file type
                if (!file.type.startsWith('image/')) {
                    showNotification('Please select an image file', 'error');
                    return;
                }
                
                // Create object URL for preview
                const imageUrl = URL.createObjectURL(file);
                preview.src = imageUrl;
                preview.classList.remove('hidden');
                
                // Store the file for later use
                preview.dataset.file = file;
            }
        }

        function saveNewProduct(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const preview = document.getElementById('image-preview');
            
            // Get image data
            let imageData = '';
            if (preview.dataset.file) {
                // Convert file to base64 for storage
                const file = preview.dataset.file;
                const reader = new FileReader();
                reader.onload = function(e) {
                    imageData = e.target.result;
                    saveProductWithImage(formData, imageData);
                };
                reader.readAsDataURL(file);
            } else {
                // No image provided, use placeholder
                imageData = 'https://via.placeholder.com/300x300?text=No+Image';
                saveProductWithImage(formData, imageData);
            }
        }

        function saveProductWithImage(formData, imageData) {
            const newProduct = {
                id: Math.max(...products.map(p => p.id)) + 1,
                name: formData.get('name'),
                nameAr: formData.get('nameAr'),
                price: parseFloat(formData.get('price')),
                stock: parseInt(formData.get('stock')),
                category: formData.get('category'),
                image: imageData
            };
            
            products.push(newProduct);
            
            // Save to localStorage for sync with main website
            localStorage.setItem('stationeryProducts', JSON.stringify(products));
            
            showNotification(`Product "${newProduct.name}" added successfully`, 'success');
            loadProducts();
            loadInventory();
            document.querySelector('.fixed').remove();
        }

        function printOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Order Receipt - ${orderId}</title>
                        <style>
                            body { font-family: Arial, sans-serif; font-size: 12px; margin: 20px; }
                            .text-center { text-align: center; }
                            .font-bold { font-weight: bold; }
                            .border-t { border-top: 1px solid #ccc; }
                            .mt-4 { margin-top: 16px; }
                            .mb-2 { margin-bottom: 8px; }
                        </style>
                    </head>
                    <body>
                        <div class="text-center mb-4">
                            <h3 class="font-bold">Knowledge Development Stationery</h3>
                            <p>قرطاسية تنمية المعرفة</p>
                            <p>8480 Hamad Al Jaser, AR Rawdah District</p>
                            <p>Jeddah 23435, Saudi Arabia</p>
                            <p>+966 12 236 7510</p>
                        </div>
                        
                        <div class="border-t pt-2 mb-4">
                            <div>Order #: ${orderId}</div>
                            <div>Date: ${order.date}</div>
                            <div>Customer: ${order.customer}</div>
                        </div>

                        <div class="mb-4">
                            ${order.items.map(item => `
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span>${item.name} × ${item.quantity}</span>
                                    <span>${(item.price * item.quantity).toFixed(2)} ﷼</span>
                                </div>
                            `).join('')}
                        </div>

                        <div class="border-t pt-2">
                            <div style="display: flex; justify-content: space-between; font-weight: bold;">
                                <span>Total:</span>
                                <span>${order.total.toFixed(2)} ﷼</span>
                            </div>
                        </div>

                        <div class="border-t pt-2 mt-4 text-center">
                            <p>Payment Method: ${order.paymentMethod}</p>
                            <p class="font-bold" style="color: green;">PAYMENT SUCCESSFUL</p>
                            <p>Show this receipt for pickup</p>
                        </div>
                        
                        <div class="text-center mt-4">
                            <img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=${encodeURIComponent(`${window.location.origin}/order-tracker.html?id=${orderId}`)}" alt="QR Code" style="width: 120px; height: 120px;">
                            <p style="font-size: 10px; margin-top: 4px;">Scan for order details</p>
                        </div>
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Check authentication
        function checkAuth() {
            const isLoggedIn = localStorage.getItem('adminLoggedIn');
            const loginTime = localStorage.getItem('adminLoginTime');
            
            if (!isLoggedIn || !loginTime) {
                window.location.href = 'admin-login.html';
                return false;
            }
            
            const loginDate = new Date(loginTime);
            const now = new Date();
            const hoursSinceLogin = (now - loginDate) / (1000 * 60 * 60);
            
            // Auto-logout after 8 hours
            if (hoursSinceLogin >= 8) {
                localStorage.removeItem('adminLoggedIn');
                localStorage.removeItem('adminLoginTime');
                window.location.href = 'admin-login.html';
                return false;
            }
            
            return true;
        }

        function logout() {
            localStorage.removeItem('adminLoggedIn');
            localStorage.removeItem('adminLoginTime');
            window.location.href = 'admin-login.html';
        }

        function exportReport() {
            // Calculate report data
            const totalOrders = orders.length;
            const totalRevenue = orders.reduce((sum, order) => sum + order.total, 0);
            const completedOrders = orders.filter(order => order.status === 'ready' || order.status === 'picked_up').length;
            const pendingOrders = orders.filter(order => order.status === 'pending' || order.status === 'paid' || order.status === 'processing').length;
            
            // Create CSV content
            const csvContent = [
                ['Order ID', 'Customer', 'Items', 'Total', 'Status', 'Date', 'Payment Method'],
                ...orders.map(order => [
                    order.id,
                    order.customer,
                    order.items.map(item => `${item.name} (${item.quantity})`).join('; '),
                    order.total.toFixed(2),
                    order.status,
                    order.date,
                    order.paymentMethod
                ])
            ].map(row => row.join(',')).join('\n');
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `sales-report-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Report exported successfully!', 'success');
        }

        function showAddStockModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center p-2 sm:p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-lg w-full">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-semibold">Add Stock & Edit Product</h2>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <form onsubmit="addStock(event)">
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Select Product</label>
                                <select name="productId" id="stock-product-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required onchange="loadProductDetails(this.value)">
                                    <option value="">Choose a product...</option>
                                    ${products.map(product => `
                                        <option value="${product.id}">${product.name} (Current: ${product.stock})</option>
                                    `).join('')}
                                </select>
                            </div>
                            
                            <div id="product-details" class="hidden mb-4 p-4 bg-gray-50 rounded-lg">
                                <h3 class="font-medium text-gray-900 mb-3">Product Details</h3>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">English Name</label>
                                        <input type="text" name="name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Arabic Name</label>
                                        <input type="text" name="nameAr" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Price (SAR)</label>
                                        <input type="number" name="price" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Section/Category</label>
                                        <select name="category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="pens">Pens & Writing</option>
                                            <option value="notebooks">Notebooks & Paper</option>
                                            <option value="office">Office Supplies</option>
                                            <option value="art">Art Supplies</option>
                                            <option value="school">School Supplies</option>
                                            <option value="printing">Printing & Technology</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Quantity to Add</label>
                                <input type="number" name="quantity" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Reason (Optional)</label>
                                <input type="text" name="reason" placeholder="e.g., New shipment, Returned items" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div class="flex justify-end space-x-3">
                                <button type="button" onclick="this.closest('.fixed').remove()" class="btn-secondary">Cancel</button>
                                <button type="submit" class="btn-primary">Add Stock & Update</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function loadProductDetails(productId) {
            const product = products.find(p => p.id === parseInt(productId));
            const detailsDiv = document.getElementById('product-details');
            
            if (product) {
                detailsDiv.classList.remove('hidden');
                
                // Fill in the form fields
                detailsDiv.querySelector('input[name="name"]').value = product.name;
                detailsDiv.querySelector('input[name="nameAr"]').value = product.nameAr;
                detailsDiv.querySelector('input[name="price"]').value = product.price;
                detailsDiv.querySelector('select[name="category"]').value = product.category;
            } else {
                detailsDiv.classList.add('hidden');
            }
        }

        function addStock(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const productId = parseInt(formData.get('productId'));
            const quantity = parseInt(formData.get('quantity'));
            const reason = formData.get('reason');
            
            // Get updated product details
            const name = formData.get('name');
            const nameAr = formData.get('nameAr');
            const price = parseFloat(formData.get('price'));
            const category = formData.get('category');
            
            const product = products.find(p => p.id === productId);
            if (product) {
                // Update product details
                product.name = name;
                product.nameAr = nameAr;
                product.price = price;
                product.category = category;
                product.stock += quantity;
                
                // Save to localStorage for sync with main website
                localStorage.setItem('stationeryProducts', JSON.stringify(products));
                
                showNotification(`Updated ${product.name} and added ${quantity} units. New stock: ${product.stock}`, 'success');
                loadProducts();
                loadInventory();
                event.target.closest('.fixed').remove();
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            if (checkAuth()) {
                loadOrders();
            }
        });
    </script>
</body>
</html>
